name:  ESP32 board on CI
on: [push, pull_request]
jobs:
  build-sketch:
    runs-on: ubuntu-latest
    
    steps:
       - name: Checkout
         uses: actions/checkout@v2
 
             
       - name: upload
         uses: actions/upload-artifact@master
         with:
          name: app-version-${{ env.VERSION }}
          path: app-${{ env.VERSION }}.exename:ESP32 board on CI
      
     
       - name: install nativ packages
         run: | 
               arduino-cli lib install "Adafruit BME280 Library"
               arduino-cli lib install "Adafruit Unified Sensor"
       - name:  Install 'third-party' #packages: find proper location and 'git clone'
         run: | 
                arduino-cli config dump
                apt-get install git -y
                cd `arduino-cli config dump | grep sketchbook | sed 's/.*\ //'`/libraries
                git clone https://github.com/me-no-dev/AsyncTCP.git
                git clone https://github.com/me-no-dev/ESPAsyncWebServer.git
                git clone https://github.com/ThingPulse/esp8266-oled-ssd1306.git
                git clone https://github.com/RoboticsBrno/ESP32-Arduino-Servo-Library.git

       - name: Get Python3
         uses: actions/setup-python@v1
         with:
          python-version: '3.x'
       - name: Fetch sketch dependencies
         run: |
           apt-get install python -y
           python get-pip.py
           pip3 install pyserial
           arduino-cli core install esp32:esp32 --additional-urls "https://dl.espressif.com/dl/package_esp32_index.json"
           adafruit.github.io/arduino-board-index/package_adafruit_index.json
           aw.githubusercontent.com/Seeed-Studio/Seeed_Platform/master/package_seeeduino_boards_index.json
           arduino-cli lib install "ESP32 AnalogWrite"
           arduino-cli lib install "ServoESP32"
           
       
   
       - name: Compile Sketch
         run: |
          arduino-cli compile --fqbn esp32:esp32:esp32 -o ignored.bin robot.ino
         
      
  

 
   
 
